<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>es6문법_01_파일첨부리스트 구현하기</title>
</head>

<body>
  <h2>es6문법_01_파일첨부리스트 구현하기</h2>
  <div id="preview"></div>
  <input type="file" name="" id="file_input" multiple>
  <script>
    //객체 생성하기 기능 내용 작성하기
    const handler = {
      init() {
        //변수 만들기
        const file_input = document.querySelector('#file_input');
        const preview = document.querySelector('#preview'); //출력 변수
        //버튼 클릭시 이벤트 발생
        file_input.addEventListener('change', () => { //첨부버튼 클릭시 input은 change
          console.dir(file_input); //객체를 ‘구조도’처럼 펼쳐서 보여주는
          const files = Array.from(file_input.files);
          //파일 첨부시마다 각각 해당 파일명 확장자 X버튼 리스트로 출력
          files.forEach(file => {
            preview.innerHTML += `
            <p id="${file.lastModified}">${file.name} <button data-index='${file.lastModified}' class="file_remove">X</button></p>
            `; //p태그, 버튼 생성 lastModified = 파일 마지막 수정시간( 파일 고유 값X, 편의상 쓰는 식별자)
            /*이름 (file.name)
              크기 (file.size)
              타입 (file.type)
              마지막 수정 시간 (file.lastModified)*/
          });
        });
      },
      //삭제 버튼 클릭시 해당 index값에 맞는 이미지 삭제하기
      removeFile: () => {
        document.addEventListener('click', (e) => { //X버튼 클릭하면
          if (e.target.className !== 'file_remove') return; //해당 클래스명이 존재하지 않는다면 종료
          //클래스명 있다면 삭제하고자 하는 해당 데이타 인덱스 값을 변수에 담는다
          const removeTargetId = e.target.dataset.index; //해당 index값 저장
          const removeTarget = document.getElementById(removeTargetId); //해당 id값 저장
          const files = document.querySelector('#file_input').files; //파일 리스트 저장
          const dataTransfer = new DataTransfer(); //파일 삭제시 새로운 파일 목록 생성한다.
          //파일명 삭제후 다시 배열 정리(남은 파일목록만 다시 정리하여 보여줌)
          Array.from(files)
            .filter(file => file.lastModified != removeTargetId)
            .forEach(file => dataTransfer.items.add(file));
          document.querySelector('#file_input').files = dataTransfer.files;
          removeTarget.remove(); //해당 targetId값 제거
        });
      }
    }
    //객체 실행하기
    handler.init(); //첨부기능실행
    handler.removeFile(); //삭제기능 실행
  </script>
</body>

</html>